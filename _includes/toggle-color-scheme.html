{% capture btn_aria_label %}
  {%- if site.color_scheme == 'dark' -%}
  Switch to Light Mode
  {%- else -%}
  Switch to Dark Mode
  {%- endif -%}
{% endcapture %}

<span class="fs-3">
  <button type="button"
    class="btn js-toggle-dark-mode btn-outline"
    style="margin-right: -3px; border-top-right-radius: 0; border-bottom-right-radius: 0;"
    aria-label="{{ btn_aria_label }}">
    {%- if site.color_scheme == 'dark' -%}
    ðŸ”† Light Mode
    {%- else -%}
    ðŸŒ™ Dark Mode
    {%- endif -%}
  </button>
  <button type="button"
    class="btn js-unset-color-scheme btn-outline px-2"
    style="margin-left: -3px; border-top-left-radius: 0; border-bottom-left-radius: 0;"
    aria-label="Automatically switch theme"
    ><i class="fa-solid fa-rotate" title="Automatically switch theme"></i></button>
</span>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    if (!jtd) { return; }

    const toggleSchemeBtn = document.querySelector('.js-toggle-dark-mode');
    const unsetColorScheme = document.querySelector('.js-unset-color-scheme');
    
    const logoDiv = document.querySelector('.site-logo');
    const logoUrlLight = "{{ site.logo | relative_url }}";
    // If logo_dark isn't defined, fallback to the light one to prevent errors
    const logoUrlDark = "{{ site.logo_dark | default: site.logo | relative_url }}";

    function setLogo(theme) {
      if (!logoDiv) return;
      if (theme === 'dark') {
        logoDiv.style.backgroundImage = "url('" + logoUrlDark + "')";
      } else {
        logoDiv.style.backgroundImage = "url('" + logoUrlLight + "')";
      }
    }

    // If the browser suggests a color scheme, and user hasn't saved/switch one yet..
    if (window.matchMedia && !localStorage['jtd-theme']) {
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        jtd.setTheme('dark');
        setLogo('dark');
        toggleSchemeBtn.textContent = 'ðŸ”† Light Mode';
        toggleSchemeBtn.ariaLabel = 'Switch to Light Mode';
      } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
        jtd.setTheme('light');
        setLogo('light');
        toggleSchemeBtn.textContent = 'ðŸŒ™ Dark Mode';
        toggleSchemeBtn.ariaLabel = 'Switch to Dark Mode';
      }
    } else if (localStorage['jtd-theme']) {
      jtd.setTheme(localStorage['jtd-theme']);
      setLogo(localStorage['jtd-theme']);
    }

    jtd.addEvent(toggleSchemeBtn, 'click', function() {
      if (jtd.getTheme() === 'dark') {
        localStorage['jtd-theme'] = 'light';
        jtd.setTheme('light');
        setLogo('light');
        toggleSchemeBtn.textContent = 'ðŸŒ™ Dark Mode';
        toggleSchemeBtn.ariaLabel = 'Switch to Dark Mode';
      } else {
        jtd.setTheme('dark');
        localStorage['jtd-theme'] = 'dark';
        setLogo('dark');
        toggleSchemeBtn.textContent = 'ðŸ”† Light Mode';
        toggleSchemeBtn.ariaLabel = 'Switch to Light Mode';
      }
    });

    // Add a way to unset the saved theme.
    jtd.addEvent(unsetColorScheme, 'click', function() {
      delete localStorage['jtd-theme'];

      if (window.matchMedia) {
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
          jtd.setTheme('dark');
          setLogo('dark');
        } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
          jtd.setTheme('light');
          setLogo('light');
        }
      } else {
        jtd.setTheme('default');
        setLogo('default');
      }
    });
  });
</script>